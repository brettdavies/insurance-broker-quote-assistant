# Insurance Broker Quote Assistant (IQuote Pro) - Fullstack Architecture Document

## Table of Contents

- [Insurance Broker Quote Assistant (IQuote Pro) - Fullstack Architecture Document](#table-of-contents)
  - [1. Introduction](./1-introduction.md)
    - [1.1 Starter Template or Existing Project](./1-introduction.md#11-starter-template-or-existing-project)
    - [1.2 Change Log](./1-introduction.md#12-change-log)
  - [2. High Level Architecture](./2-high-level-architecture.md)
    - [2.1 Technical Summary](./2-high-level-architecture.md#21-technical-summary)
    - [2.2 Platform and Infrastructure Choice](./2-high-level-architecture.md#22-platform-and-infrastructure-choice)
    - [2.3 Repository Structure](./2-high-level-architecture.md#23-repository-structure)
    - [2.4 High Level Architecture Diagram](./2-high-level-architecture.md#24-high-level-architecture-diagram)
    - [2.5 Architectural Patterns](./2-high-level-architecture.md#25-architectural-patterns)
  - [3. Tech Stack](./3-tech-stack.md)
    - [3.1 Technology Stack Table](./3-tech-stack.md#31-technology-stack-table)
    - [3.2 Critical Configuration](./3-tech-stack.md#32-critical-configuration)
    - [3.3 Detailed Rationale for Key Choices](./3-tech-stack.md#33-detailed-rationale-for-key-choices)
    - [3.4 Key Success Factors](./3-tech-stack.md#34-key-success-factors)
    - [3.5 Hono CLI Usage (AI-Friendly Development)](./3-tech-stack.md#35-hono-cli-usage-ai-friendly-development)
  - [4. Data Models](./4-data-models.md)
    - [4.1 Core Data Models Overview](./4-data-models.md#41-core-data-models-overview)
    - [4.2 UserProfile](./4-data-models.md#42-userprofile)
    - [4.3 Carrier](./4-data-models.md#43-carrier)
    - [4.4 Opportunity](./4-data-models.md#44-opportunity)
    - [4.5 IntakeResult](./4-data-models.md#45-intakeresult)
    - [4.6 PolicyAnalysisResult](./4-data-models.md#46-policyanalysisresult)
    - [4.7 PrefillPacket](./4-data-models.md#47-prefillpacket)
    - [4.8 DecisionTrace](./4-data-models.md#48-decisiontrace)
  - [5. API Specification](./5-api-specification.md)
    - [5.1 Core Endpoints](./5-api-specification.md#51-core-endpoints)
    - [5.2 Endpoint Details](./5-api-specification.md#52-endpoint-details)
      - [POST /api/intake](./5-api-specification.md#post-apiintake)
      - [POST /api/policy/analyze](./5-api-specification.md#post-apipolicyanalyze)
      - [GET /api/carriers](./5-api-specification.md#get-apicarriers)
      - [GET /api/health](./5-api-specification.md#get-apihealth)
    - [5.3 Type-Safe API Client (Hono RPC)](./5-api-specification.md#53-type-safe-api-client-hono-rpc)
    - [5.4 Error Handling](./5-api-specification.md#54-error-handling)
  - [6. Components](./6-components.md)
    - [6.1 Conversational Extractor Agent (LLM)](./6-components.md#61-conversational-extractor-agent-llm)
      - [6.1.1 Hybrid Extraction Logic](./6-components.md#611-hybrid-extraction-logic)
    - [6.2 Pitch Generator Agent (LLM)](./6-components.md#62-pitch-generator-agent-llm)
    - [6.3 Routing Engine (Deterministic)](./6-components.md#63-routing-engine-deterministic)
    - [6.4 Discount Engine (Deterministic)](./6-components.md#64-discount-engine-deterministic)
    - [6.5 Compliance Filter (Deterministic)](./6-components.md#65-compliance-filter-deterministic)
    - [6.6 Knowledge Pack RAG (Structured Query)](./6-components.md#66-knowledge-pack-rag-structured-query)
      - [6.6.1 Runtime Query Optimization](./6-components.md#661-runtime-query-optimization)
    - [6.7 Orchestrator](./6-components.md#67-orchestrator)
  - [7. External APIs](./7-external-apis.md)
    - [7.1 OpenAI API](./7-external-apis.md#71-openai-api)
  - [8. Core Workflows](./8-core-workflows.md)
    - [8.1 Conversational Intake Flow](./8-core-workflows.md#81-conversational-intake-flow)
      - [8.1.5 Pitch Generation with Citations](./8-core-workflows.md#815-pitch-generation-with-citations)
    - [8.2 Policy Analysis Flow](./8-core-workflows.md#82-policy-analysis-flow)
    - [8.3 Error Handling Flow](./8-core-workflows.md#83-error-handling-flow)
  - [9. Database Schema](./9-database-schema.md)
  - [10. Frontend Architecture](./10-frontend-architecture.md)
    - [10.1 Component Architecture](./10-frontend-architecture.md#101-component-architecture)
    - [10.2 State Management](./10-frontend-architecture.md#102-state-management)
    - [10.3 Routing](./10-frontend-architecture.md#103-routing)
    - [10.4 API Integration](./10-frontend-architecture.md#104-api-integration)
    - [10.5 Adaptive UI Components Implementation](./10-frontend-architecture.md#105-adaptive-ui-components-implementation)
      - [10.5.1 Emacs Multi-Keystroke State Machine](./10-frontend-architecture.md#1051-emacs-multi-keystroke-state-machine-non-standard-pattern)
      - [10.5.2 Keyboard Shortcut Handler Architecture](./10-frontend-architecture.md#1052-keyboard-shortcut-handler-architecture-non-standard-pattern)
      - [10.5.3 Modal Chat Injection Pattern](./10-frontend-architecture.md#1053-modal-chat-injection-pattern-non-standard)
      - [10.5.4 Real-Time Field Capture Sidebar](./10-frontend-architecture.md#1054-real-time-field-capture-sidebar)
    - [10.6 Keyboard Shortcuts Architecture](./10-frontend-architecture.md#106-keyboard-shortcuts-architecture)
  - [11. Backend Architecture](./11-backend-architecture.md)
    - [11.1 Service Layer Architecture](./11-backend-architecture.md#111-service-layer-architecture)
    - [11.2 Middleware Stack](./11-backend-architecture.md#112-middleware-stack)
    - [11.3 OpenAI Integration](./11-backend-architecture.md#113-openai-integration)
  - [12. Unified Project Structure](./12-unified-project-structure.md)
  - [13. Development Workflow](./13-development-workflow.md)
    - [13.1 Development Tools](./13-development-workflow.md#131-development-tools)
    - [13.2 Environment Configuration](./13-development-workflow.md#132-environment-configuration)
    - [13.3 Frontend Troubleshooting with TanStack Query DevTools](./13-development-workflow.md#133-frontend-troubleshooting-with-tanstack-query-devtools)
  - [14. Deployment Architecture](./14-deployment-architecture.md)
    - [14.1 Deployment Strategy](./14-deployment-architecture.md#141-deployment-strategy)
    - [14.2 CI/CD Pipeline](./14-deployment-architecture.md#142-cicd-pipeline)
    - [14.3 Environment Configuration](./14-deployment-architecture.md#143-environment-configuration)
  - [15. Security and Performance](./15-security-and-performance.md)
    - [15.1 Security Strategy](./15-security-and-performance.md#151-security-strategy)
    - [15.2 Performance Strategy](./15-security-and-performance.md#152-performance-strategy)
  - [16. Testing Strategy](./16-testing-strategy.md)
    - [16.1 Testing Pyramid](./16-testing-strategy.md#161-testing-pyramid)
    - [16.2 Testing Tools](./16-testing-strategy.md#162-testing-tools)
    - [16.3 Testing Focus Areas](./16-testing-strategy.md#163-testing-focus-areas)
  - [17. Coding Standards](./17-coding-standards.md)
    - [17.1 Critical Architectural Rules](./17-coding-standards.md#171-critical-architectural-rules)
    - [17.2 Naming Conventions](./17-coding-standards.md#172-naming-conventions)
    - [17.3 Implementation Guidance](./17-coding-standards.md#173-implementation-guidance)
      - [Data Transformation (snake_case â†” camelCase)](./17-coding-standards.md#data-transformation-snakecase-camelcase)
      - [Bundle Discount Data Collection](./17-coding-standards.md#bundle-discount-data-collection)
      - [Progressive Disclosure UI](./17-coding-standards.md#progressive-disclosure-ui)
      - [Citation Propagation Pattern](./17-coding-standards.md#citation-propagation-pattern)
  - [18. Error Handling Strategy](./18-error-handling-strategy.md)
    - [18.1 Error Flow Architecture](./18-error-handling-strategy.md#181-error-flow-architecture)
    - [18.2 Error Response Format (Non-Standard)](./18-error-handling-strategy.md#182-error-response-format-non-standard)
    - [18.3 Shared Error Codes (packages/shared/src/types/errors.ts)](./18-error-handling-strategy.md#183-shared-error-codes-packagessharedsrctypeserrorsts)
    - [18.4 Frontend Error Handling](./18-error-handling-strategy.md#184-frontend-error-handling)
    - [18.5 Backend Error Handling](./18-error-handling-strategy.md#185-backend-error-handling)
  - [19. Monitoring and Observability](./19-monitoring-and-observability.md)
    - [19.1 Monitoring Strategy](./19-monitoring-and-observability.md#191-monitoring-strategy)
    - [19.2 Key Metrics](./19-monitoring-and-observability.md#192-key-metrics)
    - [19.3 Observability for Evaluation](./19-monitoring-and-observability.md#193-observability-for-evaluation)
  - [20. Success Criteria and Evaluation](./20-success-criteria-and-evaluation.md)
    - [20.1 Requirements Mapping](./20-success-criteria-and-evaluation.md#201-requirements-mapping)
    - [20.2 Evaluation Harness](./20-success-criteria-and-evaluation.md#202-evaluation-harness)
    - [20.3 Key Architectural Decisions](./20-success-criteria-and-evaluation.md#203-key-architectural-decisions)
  - [Appendix: Next Steps](./appendix-next-steps.md)
    - [Immediate Next Steps (Day 1)](./appendix-next-steps.md#immediate-next-steps-day-1)
    - [Day 2-5 Implementation Plan](./appendix-next-steps.md#day-2-5-implementation-plan)
